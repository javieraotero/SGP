@using Syncrosoft.Framework.Controles.MVC.Script;
@using Syncrosoft.Framework.Controles.Mvc.JQuery.Datatables;
@using SSO.SGP.Web.Controllers;
@using Syncrosoft.Framework.Controles.MVC;
@using SSO.SGP.EntidadesDeNegocio.Vistas;
@model SSO.SGP.EntidadesDeNegocio.ExpedientesDocumentoadm

<!--
    CODE GENERATED BY Xeus Technology
    Date:  28/07/2016 22:02:35
    Version: 3
-->
@{
    Layout = null;
    var hash = "form" + Session.GetHashCode();
    var value = "";
}
@Scripts.Render("~/bundles/jqueryval")
<!-- SCRIPTS -->
<script src="~/ts/ArchivosAdjuntos/File.js"></script>
<script src="~/ts/ArchivosAdjuntos/ArchivosAdjuntosManager.js"></script>
<!-- /SCRIPTS -->

@using (Html.BeginForm("Crear", "Archivos", FormMethod.Post, new { id = hash }))
{
    <div class="container-fluid">

        <div class="row">
            <div class="col-md-12">
                <div class="control-group">
                    <label class="control-label" for="Escudo" style="font-weight: bold">Subir Archivo</label>
                    <div class="controls">
                        <span class="btn btn-success fileinput-button">
                            <i class="glyphicon glyphicon-plus"></i>
                            <span>Seleccionar Archivo...</span>s
                            <input id="fileuploadArchivo@(hash)" type="file" name="files[]" data-url="ArchivosAdjuntos/Upload/?agente=@ViewBag.agente" multiple />
                            <input type="hidden" id="Archivo@(hash)" name="Archivo" />
                        </span>
                        <br />
                        <br />
                        <div id="progress" class="progress">
                            <div class="progress-bar progress-bar-success"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="control-group">
                    <label class="control-label" for="Escudo" style="font-weight: bold">Descripción</label>
                    <div class="controls">
                        <textarea id="descripcion" class="form-control" rows="4" style="width:100%"></textarea> 
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">

            <input type="button" value="Cancelar" id="Cancelar@(hash)" name="Cancelar" class="btn red" />

            <input type="button" value="Guardar" id="Guardar@(hash)" name="Guardar" class="btn green" />

            <input type="hidden" id="Agente" value="@ViewBag.Agente" />

            @*<input type="button" value="GuardarYNuevo" id="GuardarYNuevo@(hash)" name="Guardar y subir otro archivo" class="btn blue" />*@
        </div><!--fin form-actions>-->
    </div>
}
<script type="text/javascript">
    var archivo = "";

    $(function () {
        app.Desbloquear();

        $("#Cancelar@(hash)").click(function (e) {
            e.preventDefault();
            app.modal.cerrar();
        });

        $("#Guardar@(hash)").click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                url: "/RRHH/Agentes/CrearAdjunto",
                data: JSON.stringify({ agente: $("#Agente").val(), descripcion: $("#descripcion").val(), archivo: $("#Archivo@(hash)").attr("data-nombre") }),
                success: function (data) {
                    if (data[0]) {
                        app.crearNotificacionSuccess("Resultado", data[1]);
                        dtArchivosAdjuntos.fnDraw();
                        app.modal.cerrar();
                    } else {
                        app.crearNotificacionError("Error", data[1]);
                        //resultado.anexos.diastopeexcepcion = data[2];
                    }
                },
                error: function (jqXhr, textStatus, errorThrown) {
                    alert("Error al procesar formulario ajax");
                    resultado.exception = textStatus + " - " + errorThrown;
                },
                complete: function () {
                    app.Desbloquear();
                }
            })
        });

    });
    if (oArchivosAdjuntos == null)
        var oArchivosAdjuntos = new ArchivosAdjuntos.ts.ArchivosAdjuntosManager();
    var viewFile = new ArchivosAdjuntos.ts.File("@(hash)");
    //oArchivosAdjuntos.setFile(viewFile);

    $('#fileuploadArchivo@(hash)').bind('fileuploadsubmit', function (e, data) {
        data.formData = { expediente: $("#Data").val() };
    });
</script>