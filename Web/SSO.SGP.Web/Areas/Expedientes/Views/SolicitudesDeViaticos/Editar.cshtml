@using Syncrosoft.Framework.Controles.MVC.Script;
@using Syncrosoft.Framework.Controles.Mvc.JQuery.Datatables;
@using SSO.SGP.Web.Areas.Expedientes.Controllers
@using Syncrosoft.Framework.Controles.MVC;
@using SSO.SGP.EntidadesDeNegocio.Vistas;
@model SSO.SGP.EntidadesDeNegocio.SolicitudesDeViaticos

<!--
    CODE GENERATED BY Xeus Technology
    Date:  13/12/2018 7:26:22
    Version: 3
-->
@{
    Layout = null;
    var hash = "form" + Session.GetHashCode();
    var value = "";
}

<script src="@Url.Content("~/assets/plugins/bootstrap-switch/static/js/bootstrap-switch.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/assets/plugins/chosen-bootstrap/chosen/chosen.jquery.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/assets/plugins/tinymce/js/tinymce/tinymce.min.js")" type="text/javascript"></script>
<link rel="stylesheet" href="@Url.Content("~/assets/plugins/bootstrap-switch/static/stylesheets/bootstrap-switch.min.css")" />
<link rel="stylesheet" href="@Url.Content("~/assets/plugins/chosen-bootstrap/chosen/chosen.css")" />
<script src="@Url.Content("~/assets/plugins/tinymce/js/tinymce/tinymce.min.js")" type="text/javascript"></script>
@Scripts.Render("~/bundles/jqueryval")
<script src="Areas/Expedientes/ts/SolicitudesDeViaticos/Crear.js"></script>
<script src="ts/Syncro/SyncroModal.js"></script>
<script src="ts/Syncro/SyncroAutocomplete.js"></script>
<script src="~/Scripts/moment.js"></script>

@using (Html.BeginForm("Crear", "SolicitudesDeViaticos", FormMethod.Post, new { id = hash }))
{
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Fecha">Fecha</label>
                    <div class="controls">
                        <div class="input-append date date-picker" data-date-format="dd-mm-yyyy" data-date-viewmode="years">
                            <input type="text" class="form-control col-md-12 date-picker" disabled="disabled" id="Fecha@(hash)" tabindex="2" name="Fecha" value="@Model.Fecha.ToShortDateString()" />
                            <span class="add-on"><i class="icon-calendar"></i></span>
                        </div>
                        <script type="text/javascript">
                            @*$(function () {
                                //$('#Fecha@(hash)').datepicker(pickerOpts);
                                $('#Fecha@(hash)').datetimepicker({
                                    viewMode: 'years'
                                });
                            });*@
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="OrganismoSolicitante">Organismo Solicitante</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="OrganismoSolicitanteText@(hash)" name="OrganismoSolicitanteText" disabled="disabled" tabindex="3" value="@ViewBag.Organismo" )" />
                        <input type="hidden" id="OrganismoSolicitante@(hash)" name="OrganismoSolicitante" value="@Model.OrganismoSolicitante" />
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="control-group">
                    <label class="control-label" for="Destino">Destino</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="txtDestino@(hash)" tabindex="4" value="@ViewBag.Destino" />
                        <input type="hidden" class="form-control col-md-12" id="Destino@(hash)" name="Destino" tabindex="4" value="@Model.Destino" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="FechaDeInicio">Fecha y Hora de Inicio</label>
                    <div class="controls">
                        <div class="input-append date date-picker" data-date="12-02-2012" data-date-format="dd-mm-yyyy" data-date-viewmode="years">
                            <input type="text" class="form-control col-md-12 date-picker" id="FechaDeInicio@(hash)" tabindex="5" name="FechaDeInicio" value="@Model.FechaDeInicio.ToString("yyyy-MM-dd HH:mm")" />
                            <span class="add-on"><i class="icon-calendar"></i></span>
                        </div>
                        <script type="text/javascript">
                            $(function () {
                                 var start = new Date();
                                // set end date to max one year period:
                                var end = new Date(new Date().setYear(start.getFullYear() + 1));
                                //$('#Fecha@(hash)').datepicker(pickerOpts);
                                $('#FechaDeInicio@(hash)').datetimepicker({
                                    startDate: start,
                                    endDate: end,
                                    viewMode: 'years'
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="FechaDeFin">Fecha y Hora de Fin</label>
                    <div class="controls">
                        <div class="input-append date date-picker" data-date-format="dd-mm-yyyy" data-date-viewmode="years">
                            <input type="text" class="form-control col-md-12 date-picker" id="FechaDeFin@(hash)" tabindex="6" name="FechaDeFin" value="@Model.FechaDeFin.ToString("yyyy-MM-dd HH:mm")" />
                            <span class="add-on"><i class="icon-calendar"></i></span>
                        </div>
                        <script type="text/javascript">
                            $(function () {
                               var start = new Date();
                                // set end date to max one year period:
                                var end = new Date(new Date().setYear(start.getFullYear() + 1));
                                //$('#Fecha@(hash)').datepicker(pickerOpts);
                                $('#FechaDeFin@(hash)').datetimepicker({
                                    startDate: start,
                                    endDate: end,
                                    viewMode: 'years'
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Anticipo">Solicita anticipo</label>
                    <div class="controls">
                        <input type="checkbox" class="form-control col-md-12" id="Anticipo@(hash)" name="Anticipo" tabindex="9" value="@Model.SolicitaAnticipo.ToString().ToLower()" @(Model.SolicitaAnticipo ? " checked " : "") />
                        <script type="text/javascript">
                            $(function () {
                                $('#Anticipo@(hash)').bootstrapSwitch();
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="FechaDeFin">Estado Actual</label>
                    <div class="controls">
                        <span class="control-label">
                            @switch (Model.Estado)
                            {
                                case 1:
                                    <strong>Borrador</strong>
                                    break;
                                case 2:
                                    <strong>Solicitud Enviada</strong>
                                    break;
                                case 3:
                                    <strong>Rechazado</strong>
                                    break;
                                case 4:
                                    <strong>Solicitud Aprobada</strong>
                                    break;
                                case 5:
                                    <strong>Borrador de Rendición</strong>
                                    break;
                                case 7:
                                    <strong>Ant. Depositado</strong>
                                    break;
                                case 8:
                                    <strong>Borrador Rendición</strong>
                                    break;
                                case 9:
                                    <strong>Rendición Enviada</strong>
                                    break;
                                case 10:
                                    <strong>Rendición Rechazada</strong>
                                    break;
                                case 11:
                                    <strong>Rendición Aprobada</strong>
                                    break;
                                case 12:
                                    <strong>Pendiente de Asignar Chofer y/o vehículo</strong>
                                    break;
                            }
                        </span>
                    </div>
                </div>
            </div>
            @if (SSO.SGP.Web.SessionHelper.OficinaActual == 829 || SSO.SGP.Web.SessionHelper.OficinaActual == 308 || SSO.SGP.Web.SessionHelper.OficinaActual == 783)
            {
                <div class="col-md-3">
                    <div class="control-group">
                        <label class="control-label" for="FechaDeFin">Acciones:</label>
                        <div class="controls">
                            <select id="Estado@(hash)" value="@Model.Estado" class="form-control">
                                <option value="0">Seleccione</option>
                                @if (Model.Estado == 2)
                                {
                                    <option value="3">Rechazar Solicitud</option>
                                    <option value="4">Aprobar Solicitud</option>
                                    <option value="7">Marcar como Depositado</option>
                                }
                                @if (Model.Estado == 4)
                                {
                                    <option value="7">Marcar como Depositado</option>
                                }
                                @if (Model.Estado == 9)
                                {
                                    <option value="10">Rechazar Rendición</option>
                                    <option value="11">Aprobar Rendición</option>
                                }
                            </select>
                            <script type="text/javascript">

                            </script>
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="MedioDeTransporte">Medio De Transporte</label>
                    <div class="controls">
                        @*<input type="text" class="form-control col-md-12" id="MedioDeTransporte@(hash)" name="MedioDeTransporte" tabindex="7" value="@Model.MedioDeTransporte" )" />*@
                        <select id="MedioDeTransporte@(hash)" class="form-control" name="MedioDeTransporte">
                            @if ((bool)ViewBag.AutoPropio == true)
                            {
                                <option value="5">Auto Poder Judicial Asignado a la Oficina</option>
                            }
                            <option value="1">Auto Poder Judicial</option>
                            <option value="2">Auto Propio</option>
                            <option value="3">Colectivo</option>
                            <option value="4">Avión</option>
                        </select>
                        <script>
                            $(function () {
                                $("#MedioDeTransporte@(hash)").find("option[value=@Model.MedioDeTransporte]").prop("selected", "selected");
                                if ($("#MedioDeTransporte@(hash)").val() == 2) {
                                    $("#auto_propio@(hash)").show();
                                }
                            });
                        </script>
                        <script>
                            $(function () {
                                $("#MedioDeTransporte@(hash)").change(function (e) {
                                    if ($(this).val() == 2) {
                                        $("#auto_propio@(hash)").show();
                                    } else {
                                        $("#auto_propio@(hash)").hide();
                                    }
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="control-group">
                    <label class="control-label" for="ConChofer">Chofer?</label>
                    <div class="controls">
                        <input type="checkbox" class="form-control col-md-12" id="ConChofer@(hash)" name="ConChofer" tabindex="9" value="@Model.ConChofer.ToString().ToLower()" @(Model.ConChofer ? " checked " : "") />
                        <script type="text/javascript">
                            $(function () {
                                $('#ConChofer@(hash)').bootstrapSwitch();
                            });
                        </script>
                    </div>
                </div>
            </div>
            @if (SSO.SGP.Web.SessionHelper.OficinaActual == 21 || SSO.SGP.Web.SessionHelper.OficinaActual == 785)
            {
                <div class="col-md-4">
                    <div class="control-group">
                        <label class="control-label" for="AutoOficial">Auto Oficial</label>
                        <div class="controls">
                            <select id="AutoOficial@(hash)" class="form-control  col-md-12" name="AutoOficial" tabindex="1">
                                <option value="0">Seleccione</option>
                                @foreach (var e in (IEnumerable<SelectOptionsView>)ViewBag.AutoOficial)
                                {
                                    if (Model.AutoOficial != e.value)
                                    {
                                        <option value="@e.value">@e.text</option>
                                    }
                                    else
                                    {
                                        <option selected value="@e.value">@e.text</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="row" id="auto_propio@(hash)" style="display:none">
            <div class="col-md-2">
                <div class="control-group">
                    <label class="control-label" for="Estado">Patente</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="Patente@(hash)" name="Patente" tabindex="14" value="@Model.Patente" />
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Estado">Seguro (empresa y número)</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="Seguro@(hash)" name="Seguro" tabindex="14" value="@Model.Seguro" />
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Estado">Vigencia Seg.</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="VigenciaSeguro@(hash)" name="VigenciaSeguro" tabindex="14" value="@Model.VigenciaSeguro" />
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Estado">Vehículo</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="TipoVehiculo@(hash)" name="TipoVehiculo" tabindex="14" value="@Model.TipoVehiculo" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">

                <div class="control-group">
                    <label class="control-label" for="MotivoDeComision">Motivo De Comisión</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="MotivoDeComision@(hash)" name="MotivoDeComision" tabindex="15" value="@Model.MotivoDeComision" )" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="control-group">
                    <label class="control-label" for="MotivoDeComision">Agentes</label>
                    <table id="tableAgentes@(hash)" class="table table-hover table-advance table-bordered">
                        <thead>
                            <tr>
                                <th style="width:25%">
                                    <input type="text" id="txtAgente@(hash)" class="form-control col-md-12" tabindex="1" placeholder="Seleccione Agente" /><br />
                                    <p class="help-block"></p>
                                    <input type="hidden" id="Agente@(hash)" name="Agente" />
                                </th>
                                <th style="width:10%">
                                    Afiliado
                                </th>
                                <th style="width:20%">
                                    Categoría
                                </th>
                                <th style="width:8%">
                                    Días
                                </th>
                                <th style="width:8%">
                                    $ día
                                </th>
                                <th style="width:10%">
                                    Víatico
                                </th>
                                <th style="width:10%">
                                    Gastos
                                </th>
                                <th style="width:10%">
                                    Total
                                </th>
                            </tr>                           
                        </thead>
                        <tbody id="bodyAgentes@(hash)"></tbody>
                        <tfoot>
                            <tr>
                                <td colspan="7">
                                    TOTAL A SOLICITAR
                                </td>
                                <td>
                                    <span id="TotalASolicitar@(hash)">0</span>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        <div>
            @if (Model.SolicitudesDeViaticosRendiciones.Count() > 0)
            {
                <br />
                                <br />
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="control-group">
                                            <label class="control-label" for="MotivoDeComision"><b>Rendición</b></label>
                                            <div class="controls" id="divRendicion">
                                                <script>
                                                    $(function () {
                                                        $("#divRendicion").load("Expedientes/SolicitudesDeViaticos/EditarRendicion/@Model.SolicitudesDeViaticosRendiciones.First().Id");
                                                    });
                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                </div>
            }
        </div>
        <div id="parsered" style="display:none"></div>
        <div class="form-actions">
            <input type="hidden" id="Comision@(hash)" value="@Model.Comision" name="Comision" />
            <input type="hidden" value="@Model.Id" name="Id" id="Id@(hash)" />
            <input type="hidden" value="@Model.FechaAlta" name="FechaAlta" id="FechaAlta@(hash)" />
            <input type="hidden" value="@Model.UsuarioAlta" name="UsuarioAlta" id="UsuarioAlta@(hash)" />
            <input type="button" value="Cerrar" id="Cancelar@(hash)" name="Cancelar" class="btn red" />
            <input type="button" value="Guardar Borrador" id="Guardar@(hash)" name="Guardar" class="btn green" />
            <input type="button" value="Guardar y Confirmar" id="GuardarYConfirmar@(hash)" name="GuardarYNuevo" class="btn blue" />
            @if (Model.Estado > 2)
            {
                <input type="button" value="Imprimir Solicitud" id="ImprimirSolicitud@(hash)" name="Imprimir" class="btn yellow" />
            }
                @if (Model.Estado == 1 || Model.Estado == 2)
                {
                    <input type="button" value="Cancelar Solicitud" id="CancelarSolicitud@(hash)" name="Cancelar" class="btn yellow" />
                }
            </div><!--fin form-actions>-->
    </div>
    <div class="modal fade" id="ImprimirSolicitudModal@(hash)" role="basic" aria-hidden="true">
        <div class="modal-dialog modal-wide">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">Solicitud</h4>
                </div>
                <div class="modal-body">
                    <input type="text" id="TextoSolicitud@(hash)" class="col-md-12 form-control"/>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
}
<script type="text/javascript">
    $(function () {
        app.Desbloquear();
    });
    var viewCrear = new SolicitudesDeViaticos.ts.Crear("@(hash)");
    oSolicitudesDeViaticos.setEditar(viewCrear);
</script>
