@using Syncrosoft.Framework.Controles.MVC.Script;
@using Syncrosoft.Framework.Controles.Mvc.JQuery.Datatables;
@using SSO.SGP.Web.Areas.Expedientes.Controllers
@using Syncrosoft.Framework.Controles.MVC;
@using SSO.SGP.EntidadesDeNegocio.Vistas;
@model SSO.SGP.EntidadesDeNegocio.SolicitudesDeViaticos

<!--
    CODE GENERATED BY Xeus Technology
    Date:  13/12/2018 7:26:22
    Version: 3
-->
@{
    Layout = null;
    var hash = "form" + Session.GetHashCode();
    var value = "";
}

<script src="@Url.Content("~/assets/plugins/bootstrap-switch/static/js/bootstrap-switch.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/assets/plugins/chosen-bootstrap/chosen/chosen.jquery.min.js")" type="text/javascript"></script>
<link rel="stylesheet" href="@Url.Content("~/assets/plugins/bootstrap-switch/static/stylesheets/bootstrap-switch.min.css")" />
<link rel="stylesheet" href="@Url.Content("~/assets/plugins/chosen-bootstrap/chosen/chosen.css")" />
@Scripts.Render("~/bundles/jqueryval")
<script src="Areas/Expedientes/ts/SolicitudesDeViaticos/Crear.js"></script>

<script src="ts/Syncro/SyncroModal.js"></script>
<script src="ts/Syncro/SyncroAutocomplete.js"></script>
<script src="~/Scripts/moment.js"></script>

@using (Html.BeginForm("Crear", "SolicitudesDeViaticos", FormMethod.Post, new { id = hash }))
{
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Fecha">Fecha</label>
                    <div class="controls">
                        <div class="input-append date date-picker" data-date-format="dd-mm-yyyy" data-date-viewmode="years">
                            <input type="text" class="form-control col-md-12 date-picker" disabled="disabled" id="Fecha@(hash)" tabindex="2" name="Fecha" value="@DateTime.Now.ToShortDateString()" />
                            <span class="add-on"><i class="icon-calendar"></i></span>
                        </div>
                        <script type="text/javascript">
                            @*$(function () {
                                //$('#Fecha@(hash)').datepicker(pickerOpts);
                                $('#Fecha@(hash)').datetimepicker({
                                    viewMode: 'years'
                                });
                            });*@
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="OrganismoSolicitante">Organismo Solicitante</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="OrganismoSolicitanteText@(hash)" name="OrganismoSolicitanteText" disabled="disabled" tabindex="3" value="@SSO.SGP.Web.SessionHelper.OficinaActualDescripcion" )" />
                        <input type="hidden" id="OrganismoSolicitante@(hash)" name="OrganismoSolicitante" value="@SSO.SGP.Web.SessionHelper.OficinaActual" />
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="control-group">
                    <label class="control-label" for="Destino">Destino</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="txtDestino@(hash)" tabindex="4" />
                        <input type="hidden" class="form-control col-md-12" id="Destino@(hash)" name="Destino" tabindex="4" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="FechaDeInicio">Fecha y Hora de Inicio</label>
                    <div class="controls">
                        <div class="input-append date date-picker" data-date="12-02-2012" data-date-format="dd-mm-yyyy" data-date-viewmode="years">
                            <input type="text" class="form-control col-md-12 date-picker" id="FechaDeInicio@(hash)" tabindex="5" name="FechaDeInicio" value="" />
                            <span class="add-on"><i class="icon-calendar"></i></span>
                        </div>
                        <script type="text/javascript">
                            $(function () {
                                //$('#Fecha@(hash)').datepicker(pickerOpts);
                                var start = new Date();
                                // set end date to max one year period:
                                var end = new Date(new Date().setYear(start.getFullYear() + 1));
                                $('#FechaDeInicio@(hash)').datetimepicker({
                                    viewMode: 'years',
                                    startDate: start,
                                    endDate: end
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="FechaDeFin">Fecha y Hora de Fin</label>
                    <div class="controls">
                        <div class="input-append date date-picker" data-date-format="dd-mm-yyyy" data-date-viewmode="years">
                            <input type="text" class="form-control col-md-12 date-picker" id="FechaDeFin@(hash)" tabindex="6" name="FechaDeFin" value="" />
                            <span class="add-on"><i class="icon-calendar"></i></span>
                        </div>
                        <script type="text/javascript">
                            $(function () {
                                var start = new Date();
                                // set end date to max one year period:
                                var end = new Date(new Date().setYear(start.getFullYear() + 1));
                                //$('#Fecha@(hash)').datepicker(pickerOpts);
                                $('#FechaDeFin@(hash)').datetimepicker({
                                    startDate: start,
                                    endDate: end,
                                    viewMode: 'years'
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Anticipo">Solicita anticipo</label>
                    <div class="controls">
                        <input type="checkbox" class="form-control col-md-12" id="Anticipo@(hash)" name="Anticipo" tabindex="9" value="false" />
                        <script type="text/javascript">
                            $(function () {
                                $('#Anticipo@(hash)').bootstrapSwitch();
                            });
                        </script>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div class="row" style="display:none" id="tabla_comisiones@(hash)">
            <div class="col-md-12">
                <div class="control-group">
                    <label class="control-label" for="Comisiones">¿Su solicitud pertenece a alguna de estas comisiones?</label>
                    <div class="controls">
                        <table class="table table-advance table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th style="width:10%">
                                        # Comisión
                                    </th>
                                    <th style="width:10%">
                                        Destino
                                    </th>
                                    <th style="width:15%">
                                        Desde
                                    </th>
                                    <th style="width:15%">
                                        Hasta
                                    </th>
                                    <th style="width:35%">
                                        Motivo
                                    </th>
                                    <th style="width:10%"></th>
                                </tr>
                            </thead>
                            <tbody id="body_comisiones@(hash)"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-3">

                <div class="control-group">
                    <label class="control-label" for="MedioDeTransporte">Medio De Transporte</label>
                    <div class="controls">
                        @*<input type="text" class="form-control col-md-12" id="MedioDeTransporte@(hash)" name="MedioDeTransporte" tabindex="7" value="@Model.MedioDeTransporte" )" />*@
                        <select id="MedioDeTransporte@(hash)" class="form-control" name="MedioDeTransporte">
                            @if ((bool)ViewBag.AutoPropio == true)
                            {
                               <option value="5">Auto Poder Judicial Asignado a la Oficina</option>
                            }
                            <option value="1">Auto Poder Judicial</option>
                            <option value="2">Auto Propio</option>
                            <option value="3">Colectivo</option>
                            <option value="4">Avión</option>
                        </select>
                        <script>
                            $(function () {
                                $("#MedioDeTransporte@(hash)").change(function (e) {
                                    if ($(this).val() == 2) {
                                        $("#auto_propio@(hash)").show();
                                        $("#AutoOficial@(hash)").hide();
                                    } else {
                                        $("#auto_propio@(hash)").hide();
                                        $("#AutoOficial@(hash)").show();
                                    }
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>                       
            <div class="col-md-4" id="div_chofer">
                <div class="control-group">
                    <label class="control-label" for="ConChofer">Chofer?</label>
                    <div class="controls">
                        <input type="checkbox" class="form-control col-md-12" id="ConChofer@(hash)" name="ConChofer" tabindex="9" value="false" />
                        <script type="text/javascript">
                            $(function () {
                                $('#ConChofer@(hash)').bootstrapSwitch();
                            });
                        </script>
                    </div>
                </div>
            </div>
            @if (SSO.SGP.Web.SessionHelper.OficinaActual == 21 || SSO.SGP.Web.SessionHelper.OficinaActual == 785 || (bool)ViewBag.AutoPropio == true) { 
            <div class="col-md-4" id="div_auto">
                <div class="control-group">
                    <label class="control-label" for="AutoOficial">Auto Oficial</label>
                    <div class="controls">
                        <select id="AutoOficial@(hash)" class="form-control  col-md-12" name="AutoOficial" tabindex="1">
                            <option value="0">Seleccione</option>
                            @foreach (var e in (IEnumerable<SelectOptionsView>)ViewBag.AutoOficial)
                            {
                                <option value="@e.value">@e.text</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            }
        </div>
        <div class="row" id="auto_propio@(hash)" style="display:none">
            <div class="col-md-2">
                <div class="control-group">
                    <label class="control-label" for="Estado">Patente</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="Patente@(hash)" name="Patente" tabindex="14" value="" />
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Estado">Seguro (empresa y número)</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="Seguro@(hash)" name="Seguro" tabindex="14" value="" />
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Estado">Vigencia Seg.</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="VigenciaSeguro@(hash)" name="VigenciaSeguro" tabindex="14" value="" />
                        <script>
                            $(function () {
                                $("#VigenciaSeguro@(hash)").datepicker();

                                $("#VigenciaSeguro@(hash)").change(function (e) {
                                    var fecha = new moment($(this).val(), 'DD/MM/YYYY');
                                    var inicio = new moment($("#FechaDeInicio@(hash)").val(), "YYYY-MM-DD HH:mm");

                                    console.log(inicio);

                                    if (fecha.toDate() < inicio.toDate()) {
                                        app.crearNotificacionError("Error", "El seguro no tendrá vigencia al inicio de la Solicitud");
                                    }

                                                         
                                });
                                
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="control-group">
                    <label class="control-label" for="Estado">Vehículo</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="TipoVehiculo@(hash)" name="TipoVehiculo" tabindex="14" value="" />
                    </div>
                </div>
            </div>
        </div>
        <!--fin de row-->
        <div class="row">
            <div class="col-md-12">

                <div class="control-group">
                    <label class="control-label" for="MotivoDeComision">Motivo De Comisión</label>
                    <div class="controls">
                        <input type="text" class="form-control col-md-12" id="MotivoDeComision@(hash)" name="MotivoDeComision" tabindex="15" value="@Model.MotivoDeComision" )" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="control-group">
                    <label class="control-label" for="MotivoDeComision">Agentes</label>
                    <table id="tableAgentes@(hash)" class="table table-hover table-advance table-bordered">
                        <thead>
                            <tr>
                                <th style="width:25%">
                                    <input type="text" id="txtAgente@(hash)" class="form-control col-md-12" tabindex="1" placeholder="Seleccione Agente" /><br />
                                    <p class="help-block"></p>
                                    <input type="hidden" id="Agente@(hash)" name="Agente" />
                                </th>
                                <th style="width:10%">
                                    Afiliado
                                </th>
                                <th style="width:20%">
                                    Categoría
                                </th>
                                <th style="width:8%">
                                    Días
                                </th>
                                <th style="width:8%">
                                    $ día
                                </th>
                                <th style="width:10%">
                                    Víatico
                                </th>
                                <th style="width:10%">
                                    Gastos
                                </th>
                                <th style="width:10%">
                                    Total
                                </th>
                                <th>

                                </th>
                            </tr>
                        </thead>
                        <tbody id="bodyAgentes@(hash)"></tbody>
                        <tfoot>
                            <tr>
                                <td colspan="7">
                                    TOTAL A SOLICITAR
                                </td>
                                <td>
                                    <span id="TotalASolicitar@(hash)">0</span>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        <!--fin de row-->
        @*<div class="row">
                <div class="col-md-12">
                    <div class="control-group">
                        <label class="control-label" for="Expediente">Expediente</label>
                        <div class="controls">
                            <input type="text" class="form-control col-md-12" id="Expediente@(hash)" name="Expediente" tabindex="16" value="@Model.Expediente" )" />
                        </div>
                    </div>
                </div>
            </div>*@
        <!--fin de row-->
        @*<div class="row">
                <div class="col-md-12">
                    <div class="control-group">
                        <label class="control-label" for="Identificador">Identificador</label>
                        <div class="controls">
                            <input type="text" class="form-control col-md-12" id="Identificador@(hash)" name="Identificador" tabindex="17" value="@Model.Identificador" )" />
                        </div>
                    </div>
                </div>
            </div>*@
        <div class="form-actions">
            <input type="hidden" id="Id@(hash) " />
            <input type="hidden" id="Comision@(hash)" name="Comision" />
            <input type="button" value="Cancelar" id="Cancelar@(hash)" name="Cancelar" class="btn red" />
            <input type="button" value="Guardar Borrador" id="Guardar@(hash)" name="Guardar" class="btn green" />
            <input type="button" value="Imprimir Solicitud" id="ImprimirSolicitud@(hash)" name="Imprimir" class="btn yellow" style="display:none" />
            <input type="button" value="Guardar y Confirmar" id="GuardarYConfirmar@(hash)" name="GuardarYNuevo" class="btn blue" />
        </div><!--fin form-actions>-->
    </div>
    <div id="parsered@(hash)" style="display:none"></div>
    <div class="modal fade" id="ModalGastos" role="basic" aria-hidden="true">
        <div class="modal-dialog modal-wide">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">Detalle de Gastos</h4>
                </div>
                <div class="modal-body">
                    <table class="table table-hover table-bordered">
                        <thead>
                            <tr>
                                <th>
                                    @*<input type="text" id="txtconcepto_gastos@(hash)" class="form-control" placeholder="Conceptos"/>
                                        <input type="hidden" id="concepto_gastos@(hash)"/>*@
                                    <select id="concepto" class="form-control">
                                        @foreach (var x in new SSO.SGP.AccesoADatos.ConceptosDeGastosRefAD().ObtenerOptions(""))
                                        {
                                            <option value="@x.value">@x.text</option>
                                        }
                                    </select>
                                </th>
                                <th>
                                    <input type="text" class="form-control" id="importe_gastos@(hash)" placeholder="Importe" />
                                </th>
                                <th>
                                    <a href="#" class="btn btn-info" id="guardar_gasto@(hash)">Guardar</a>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="body_gastos@(hash)"></tbody>
                    </table>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    <div class="modal fade" id="ImprimirSolicitudModal" role="basic" aria-hidden="true">
        <div class="modal-dialog modal-wide">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">Solicitud</h4>
                </div>
                <div class="modal-body">
                    <input type="text" id="TextoSolicitud@(hash)" class="col-md-12 form-control" />
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

}
<script type="text/javascript">
    $(function () {
        app.Desbloquear();
    });
    var viewCrear = new SolicitudesDeViaticos.ts.Crear("@(hash)");
    oSolicitudesDeViaticos.setCrear(viewCrear);
</script>
